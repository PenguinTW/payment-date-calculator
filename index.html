<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>收款日計算機</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: auto;
            padding: 20px;
            text-align: center;
            background-color: rgb(227, 220, 204);
            color: #333;
        }
        h2 {
            color: #444;
        }
        label, input, button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        input {
            padding: 8px;
            border: 1px solid #aaa;
            border-radius: 5px;
            background-color: #fff;
        }
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .button-group button {
            padding: 10px;
            background-color: rgb(175, 150, 120);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        .button-group button:hover, .button-group button.active {
            background-color: rgb(145, 125, 100);
        }
        @media (max-width: 400px) {
            .button-group {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            .button-group button {
                flex: 1;
            }
        }
        p {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
    <script>
        function setDefaultBillingDate() {
            let today = new Date().toISOString().split('T')[0];
            document.getElementById("billingDate").value = today;
        }

        function selectSettlementType(type) {
            document.querySelectorAll('.button-group button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(type).classList.add('active');
            document.getElementById("settlementType").value = type;
        }

        function calculatePaymentDate() {
            let billingDate = new Date(document.getElementById("billingDate").value);
            let settlementType = document.getElementById("settlementType").value;
            let settlementDay = parseInt(document.getElementById("settlementDay").value);
            let creditDays = parseInt(document.getElementById("creditDays").value);
            let paymentDay = parseInt(document.getElementById("paymentDay").value);

            let settlementDate;
            if (settlementType === "current") {
                settlementDate = new Date(billingDate);
            } else if (settlementType === "monthly") {
                settlementDate = new Date(billingDate.getFullYear(), billingDate.getMonth(), settlementDay);
                if (billingDate.getDate() > settlementDay) {
                    settlementDate.setMonth(settlementDate.getMonth() + 1);
                }
            } else if (settlementType === "nextMonth") {
                settlementDate = new Date(billingDate.getFullYear(), billingDate.getMonth() + 1, settlementDay);
            }

            let entryDate = new Date(settlementDate);
            entryDate.setDate(entryDate.getDate() + creditDays);

            let disbursementDate = new Date(entryDate);
            if (entryDate.getDate() > paymentDay) {
                disbursementDate = new Date(entryDate.getFullYear(), entryDate.getMonth() + 1, paymentDay);
            } else {
                disbursementDate = new Date(entryDate.getFullYear(), entryDate.getMonth(), paymentDay);
            }

            document.getElementById("result").innerText = "實際撥款日: " + disbursementDate.toISOString().split('T')[0];
        }

        window.onload = function() {
            setDefaultBillingDate();
            selectSettlementType('monthly');
        }
    </script>
</head>
<body>
    <h2>收款日計算機</h2>
    <label>請款日: <input type="date" id="billingDate"></label>
    <label>結帳方式:</label>
    <div class="button-group">
        <button id="current" onclick="selectSettlementType('current')">當下結</button>
        <button id="monthly" class="active" onclick="selectSettlementType('monthly')">月結</button>
        <button id="nextMonth" onclick="selectSettlementType('nextMonth')">次月結</button>
    </div>
    <input type="hidden" id="settlementType" value="monthly">
    <label>應入賬天數(月結XX): <input type="number" id="creditDays" value="60"></label>
    <label>結帳日: <input type="number" id="settlementDay" value="25"></label>
    <label>付款日: <input type="number" id="paymentDay" value="5"></label>
    <button onclick="calculatePaymentDate()">計算</button>
    <p id="result"></p>
</body>
</html>